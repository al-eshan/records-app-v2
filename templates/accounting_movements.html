{% extends "base.html" %}
{% block content %}

<div class="container" style="max-width: 1200px;">
  <div class="card shadow-sm">
    <div class="card-body p-4">
      <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
        <div>
          <h3 class="mb-1">استعلام حركات المحاسبة اليومية — {{ kind }}</h3>
          <div class="text-muted"></div>
        </div>
        <div class="d-flex gap-2">
          <a class="btn btn-outline-secondary" href="{{ url_for('accounting_es', kind=kind) }}">رجوع</a>
          <a class="btn btn-outline-primary" href="{{ url_for('accounting_daily', kind=kind, date=date_to) }}">فتح يوم</a>
        </div>
      </div>

      <hr>

      <form method="get" class="row g-3 align-items-end">
        <div class="col-md-4">
          <label class="form-label">من تاريخ</label>
          <input type="date" class="form-control" name="from" value="{{ date_from }}">
        </div>
        <div class="col-md-4">
          <label class="form-label">إلى تاريخ</label>
          <input type="date" class="form-control" name="to" value="{{ date_to }}">
        </div>
        <div class="col-md-4 d-flex gap-2">
          <button class="btn btn-success" type="submit">بحث</button>
          <a class="btn btn-outline-secondary" href="{{ url_for('accounting_movements', kind=kind, **{'from': date_from, 'to': date_to}) }}">تحديث</a>
        </div>
      </form>
      <div class="row g-3 mt-2">

  <div class="col-md-4">
    <div class="p-3 bg-light rounded totals-card">
      <div class="small text-muted">إجمالي صندوق البداية</div>
      <div class="fs-5 fw-bold">
        {{ '%.2f'|format(overall.cash_start) }}
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="p-3 bg-light rounded totals-card">
      <div class="small text-muted">إجمالي صندوق النهاية</div>
      <div class="fs-5 fw-bold">
        {{ '%.2f'|format(overall.cash_end) }}
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="p-3 bg-light rounded totals-card">
      <div class="small text-muted">إجمالي المدخلات</div>
      <div class="fs-5 fw-bold">
        {{ '%.2f'|format(overall.inputs) }}
      </div>
    </div>
  </div>

</div>

        <div class="row g-3 mt-2">

  <div class="col-md-4">
    <div class="p-3 bg-light rounded totals-card">
      <div class="small text-muted">إجمالي المصروفات العامة</div>
      <div class="fs-5 fw-bold">
        {{ '%.2f'|format(overall.general) }}
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="p-3 bg-light rounded totals-card">
      <div class="small text-muted">إجمالي المصروفات النثرية</div>
      <div class="fs-5 fw-bold">
        {{ '%.2f'|format(overall.petty) }}
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="p-3 bg-light rounded totals-card">
      <div class="small text-muted">إجمالي المصروفات</div>
      <div class="fs-5 fw-bold">
        {{ '%.2f'|format(overall.expenses) }}
      </div>
    </div>
  </div>

</div>


      <div class="row g-3 mt-2">

  <div class="col-md-4">
    <div class="p-3 bg-light rounded totals-card">
      <div class="small text-muted">الإجمالي الكلي في انجاز</div>
      <div class="fs-5 fw-bold">
        {{ '%.2f'|format(overall.total_in_enjaz) }}
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="p-3 bg-light rounded totals-card">
      <div class="small text-muted">الإجمالي الكلي</div>
      <div class="fs-5 fw-bold">
        {{ '%.2f'|format(overall.total_overall) }}
      </div>
    </div>
  </div>

  <div class="col-md-4">
    <div class="p-3 bg-light rounded totals-card">
      <div class="small text-muted">الخطاء</div>
      <div class="fs-5 fw-bold text-danger">
        {{ '%.2f'|format(overall.error) }}
      </div>
    </div>
  </div>

</div>


      <div class="table-responsive mt-3">
        <table class="table table-striped table-hover align-middle">
          <thead>
            <tr>
              <th>التاريخ</th>
              <th>صندوق البداية</th>
              <th>صندوق النهاية</th>
              <th>مدخلات</th>
              <th>مصروفات عامة</th>
              <th>مصروفات نثرية</th>
              <th>إجمالي المصروفات</th>
              <th>الإجمالي الكلي في انجاز</th>
              <th>الإجمالي الكلي</th>
              <th>الخطاء</th>
              <th></th>
            </tr>
          </thead>
          <tbody>
            {% if rows|length == 0 %}
              <tr><td colspan="11" class="text-center text-muted py-4">لا توجد بيانات ضمن هذه المدة</td></tr>
            {% endif %}
            {% for r in rows %}
              {% set expenses = (r.total_general or 0) + (r.total_petty or 0) %}
              {% set total_overall = (r.total_inputs or 0) + expenses + (r.cash_end or 0) - (r.cash_start or 0) %}
              {% set err = total_overall - (r.total_in_enjaz or 0) %}
              <tr>
                <td class="fw-semibold">{{ r.day_date }}</td>
                <td>{{ '%.2f'|format(r.cash_start or 0) }}</td>
                <td>{{ '%.2f'|format(r.cash_end or 0) }}</td>
                <td>{{ '%.2f'|format(r.total_inputs or 0) }}</td>
                <td>{{ '%.2f'|format(r.total_general or 0) }}</td>
                <td>{{ '%.2f'|format(r.total_petty or 0) }}</td>
                <td>{{ '%.2f'|format(expenses) }}</td>
                <td>{{ '%.2f'|format(r.total_in_enjaz or 0) }}</td>
                <td>{{ '%.2f'|format(total_overall) }}</td>
                <td>{{ '%.2f'|format(err) }}</td>
                <td>
                  <a class="btn btn-sm btn-outline-primary" href="{{ url_for('accounting_daily', kind=kind, date=r.day_date) }}">فتح</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>

{% endblock %}

